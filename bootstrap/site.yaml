---

- name: Create Talos ControlPlane on proxmox virtual machine
  hosts: localhost
  roles:
    - create_controlpanes
    - initialize_talos_configuration
  vars:
    proxmox:
      host: pve.home
      node: pve
      storage: local-zfs
      networkbridge: vmbr0
      user: root@pam
      password: Kbchilwl80

    talos:
      ## schematic_id includes:
      ## customization:
      ##   systemExtensions:
      ##     officialExtensions:
      ##       - siderolabs/iscsi-tools
      ##       - siderolabs/nvme-cli
      ##       - siderolabs/qemu-guest-agent
      ##       - siderolabs/thunderbolt
      ##       - siderolabs/util-linux-tools
      ##       - siderolabs/zfs
      # schematic_id: 695c96d5c3ecbe6a8d2588c42e210d356d1c9c5d280ec2d573ecf74ae0f1a8a6

      # customization:
      #     systemExtensions:
      #         officialExtensions:
      #             - siderolabs/iscsi-tools
      #             - siderolabs/nvme-cli
      #             - siderolabs/qemu-guest-agent
      #             - siderolabs/thunderbolt
      #             - siderolabs/util-linux-tools
      schematic_id: 8137792da74f62f29f1fa6b6b246ed8258608e342206f4eca3c52acd34fda23c
      version: 1.12.2

      domain_name: home
      cluster_name: k8s
      endpoint: https://kube.home:6443
      secrets_path: secrets.yaml
      boot_disk: /dev/vda

      machine:
        type: q35
        os: l26
        vga: std
        agent: true

      controlpane:
        cpu:
          type: "host"
          cores: 18
          shares: 1000
        memory:
          balloon: 1024
          limit: 16384

    controlpanes:
      - name: talos1
        vmid: 401
        mac: 54:52:00:AA:BB:01
      - name: talos2
        vmid: 402
        mac: 54:52:00:AA:BB:02
      - name: talos3
        vmid: 403
        mac: 54:52:00:AA:BB:03
