# Override chart name (default: authentik-stack)
nameOverride: ""
fullnameOverride: ""

# Database configuration
database:
  instances: 2
  size: 0.5Gi
  backupSchedule: "0 2 * * 1"
  snapshotClassName: democratic-csi

# Admin bootstrap credentials
admin:
  email: jabbas+authentik@jabbas.eu
  password: ""   # Auto-generated if empty
  token: ""      # Auto-generated if empty
  secretKey: ""  # Auto-generated if empty

# Send recovery emails to all users on install
sendRecoveryEmails:
  enabled: true

# OIDC configuration
oidc:
  clientSecret: ""  # Auto-generated if empty
  headlamp:
    # Reflector settings - allows pull-based reflection from internal-apps namespace
    reflector:
      enabled: true
      targetNamespace: internal-apps

# Authentik subchart values
authentik:
  global:
    deploymentStrategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 2
        maxUnavailable: 0
    # WARNING: Secret names below are based on fullname "authentik-stack".
    # If you change nameOverride/fullnameOverride, update these references accordingly:
    # - {fullname}-db-app (generated by CNPG from database cluster name)
    # - {fullname}-admin
    # - {fullname}-oidc-talos
    envFrom:
      - secretRef:
          name: authentik-stack-db-app
      - secretRef:
          name: authentik-stack-admin
      - secretRef:
          name: authentik-stack-oidc-talos

  authentik:
    log_level: info
    error_reporting:
      enabled: false
    secret_key: env://AUTHENTIK_SECRET_KEY
    postgresql:
      host: env://host
      name: env://dbname
      user: env://username
      password: env://password
    email:
      host: smtp-relay.gmail.com
      port: 587
      use_tls: true
      use_ssl: false
      from: authentik@jabbas.eu
      timeout: 30

  # WARNING: ConfigMap names below are from authentik-blueprints chart.
  # If you change its nameOverride/fullnameOverride, update these references accordingly:
  # - {blueprints-fullname}-talos-oidc
  # - {blueprints-fullname}-headlamp-oidc
  # - {blueprints-fullname}-groups
  # - {blueprints-fullname}-users
  blueprints:
    configMaps:
      - authentik-blueprints-recovery-flow
      - authentik-blueprints-talos-oidc
      - authentik-blueprints-headlamp-oidc
      - authentik-blueprints-groups
      - authentik-blueprints-users
      - authentik-blueprints-victoria-metrics

  server:
    replicas: 2
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      fsGroup: 1000
      seccompProfile:
        type: RuntimeDefault
    containerSecurityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
      runAsNonRoot: true
      runAsUser: 1000
      seccompProfile:
        type: RuntimeDefault
    ingress:
      enabled: true
      ingressClassName: traefik-internal
      hosts:
        - authentik.dev.home

  worker:
    replicas: 2
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      fsGroup: 1000
      seccompProfile:
        type: RuntimeDefault
    containerSecurityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
      runAsNonRoot: true
      runAsUser: 1000
      seccompProfile:
        type: RuntimeDefault
